function alpha = pendulum6DPartial( ...
  t, data, derivMin, derivMax, schemeData, dim)
% partial function for double pendulum
%
% Inputs:
%   schemeData - problem parameters
%     .grid:   grid structure
%     .Tmax:   max torgque
%     R1, R2: radius to center of mass
%     L1, L2: length of each segment
%     M1, M2: mass of each segment
%
% Dynamics:
%   \dot theta1      = omega1
%   \dot omega1      = lots of stuff
%   \dot theta2      = omega2
%   \dot omega2      = lots of stuff
%     |T| <= wMax
% ddt1 = tau1*ddt1_num_tau1/ddt1_denom +...
%     tau2*ddt1_num_tau2/ddt1_denom +...
%     tau3*ddt1_num_tau3/ddt1_denom + ...
%     ddt1_num_general/ddt1_denom;
%   
%   ddt2 = (-tau1*ddt2_num_tau1/ddt2_denom) +... 
%     (-tau2*ddt2_num_tau2/ddt2_denom)+...
%     (-tau3*ddt2_num_tau3/ddt2_denom)+...
%     (-ddt2_a_num_general/ddt2_denom)+...
%     (ddt2_b_num_general/ddt2_denom);  
%   
%  ddt3 =  (-tau1*ddt3_num_tau1/ddt3_denom) + ...
%     (-tau2*ddt3_num_tau2/ddt3_denom) + ...
%     (-tau3*ddt3_num_tau3/ddt3_denom) + ...
%     (-ddt3_a_num_general/ddt3_denom)+...
%     ddt3_b_num_general/ddt3_denom +...
%     ddt3_c_num_general/ddt3_denom ;

checkStructureFields(schemeData, 'grid',  'R1', 'R2','R3',...
  'M1','M2','M3','L1','L2','T1Max','T2Max');

g = schemeData.grid;
a1 = g.xs{1};
v1 = g.xs{2};
a2 = g.xs{3};
v2 = g.xs{4};
a3 = g.xs{5};
v3 = g.xs{6};

R1 = schemeData.R1;
R2 = schemeData.R2;
R3 = schemeData.R3;
L1 = schemeData.L1;
L2 = schemeData.L2;
M1 = schemeData.M1;
M2 = schemeData.M2;
M3 = schemeData.M3;

T1Max = schemeData.T1Max;
T2Max = schemeData.T2Max;
T3Max = schemeData.T3Max;
grav = 9.81;

ddt1_num_tau1=R3*(L2^2*M3 + M2*R2^2 - L2^2*M3*cos(a3)^2);
ddt1_num_tau2=R3*(-L2^2*M3 - M2*R2^2  + L2^2*M3*cos(a3)^2- L1*L2*M3*cos(a2) - ...
    L1*M2*R2*cos(a2) + L1*L2*M3*cos(a2 + a3)*cos(a3));
ddt1_num_tau3=L1*(-L2^2*M3*cos(a2 + a3) - M2*R2^2*cos(a2 + a3)+ L2^2*M3*cos(a2)*cos(a3) + ...
    L2*M3*R3*cos(a2)+ M2*R2*R3*cos(a2) - L2*M3*R3*cos(a2 + a3)*cos(a3) + L2*M2*R2*cos(a2)*cos(a3));
ddt1_num_general =     L1*L2^2*M3^2*R3*grav*sin(a1) + L1*M2^2*R2^2*R3*grav*sin(a1)  + ...
    L1*L2^3*M3^2*R3*v1^2*sin(a2) + L1*L2^3*M3^2*R3*v2^2*sin(a2) + ...
    L1*M2^2*R2^3*R3*v1^2*sin(a2) + L1*M2^2*R2^3*R3*v2^2*sin(a2) + ...
    L1*L2^2*M3^2*R3^2*v1^2*sin(a2+a3) + L1*L2^2*M3^2*R3^2*v2^2*sin(a2+a3)+...
    L1*L2^2*M3^2*R3^2*v3^2*sin(a2 + a3) + L1^2*L2^2*M3^2*R3*v1^2*cos(a2)*sin(a2) - ...
    L1*L2^2*M3^2*R3^2*v1^2*cos(a2)*sin(a3) - L1*L2^2*M3^2*R3^2*v2^2*cos(a2)*sin(a3) -...
    L1*L2^3*M3^2*R3*v1^2*cos(a3)^2*sin(a2) - L1*L2^2*M3^2*R3^2*v3^2*cos(a2)*sin(a3) - ...
    L1*L2^3*M3^2*R3*v2^2*cos(a3)^2*sin(a2) + L1^2*M2^2*R2^2*R3*v1^2*cos(a2)*sin(a2) - ...
    L1*L2^2*M3^2*R3*grav*sin(a1 + a2)*cos(a2) - L1*M2^2*R2^2*R3*grav*sin(a1 + a2)*cos(a2) - ...
    L1*L2^2*M3^2*R3^2*v1^2*sin(a2 + a3)*cos(a3)^2 - L1*L2^2*M3^2*R3^2*v2^2*sin(a2 + a3)*cos(a3)^2 -...
    L1*L2^2*M3^2*R3^2*v3^2*sin(a2 + a3)*cos(a3)^2 - L1*L2^2*M3^2*R3*grav*cos(a2 + a3)*sin(a1 + a2 + a3) + ...
    L1*L2^3*M3^2*R3*v1^2*cos(a2 + a3)*sin(a3) + L1*L2^3*M3^2*R3*v2^2*cos(a2 + a3)*sin(a3) +...
    L1*L2^2*M2*M3*R3*grav*sin(a1) + L2^2*M1*M3*R1*R3*grav*sin(a1) + L1*M2*M3*R2^2*R3*grav*sin(a1) + ...
    L1^2*L2^2*M3^2*R3*v1^2*cos(a2 + a3)*sin(a2 + a3) + M1*M2*R1*R2^2*R3*grav*sin(a1)  - ...
    L1*L2^2*M3^2*R3*grav*cos(a3)^2*sin(a1) + 2*L1*L2^3*M3^2*R3*v1*v2*sin(a2) + ...
    2*L1*M2^2*R2^3*R3*v1*v2*sin(a2) + L1*M2*M3*R2^2*R3^2*v1^2*sin(a2 + a3) + ...
    L1*M2*M3*R2^2*R3^2*v2^2*sin(a2 + a3) + L1*M2*M3*R2^2*R3^2*v3^2*sin(a2 + a3) +...
    2*L1*L2^2*M3^2*R3^2*v1*v2*sin(a2 + a3) + 2*L1*L2^2*M3^2*R3^2*v1*v3*sin(a2 + a3) + ...
    2*L1*L2^2*M3^2*R3^2*v2*v3*sin(a2 + a3) - 2*L1*L2^2*M3^2*R3^2*v1*v2*sin(a2 + a3)*cos(a3)^2 - ...
    2*L1*L2^2*M3^2*R3^2*v1*v3*sin(a2 + a3)*cos(a3)^2 - 2*L1*L2^2*M3^2*R3^2*v2*v3*sin(a2 + a3)*cos(a3)^2 + ...
    L1*L2*M2*M3*R2^2*R3*v1^2*sin(a2) + L1*L2^2*M2*M3*R2*R3*v1^2*sin(a2) + ...
    L1*L2*M2*M3*R2^2*R3*v2^2*sin(a2) + L1*L2^2*M2*M3*R2*R3*v2^2*sin(a2) - ...
    L1*M2*M3*R2^2*R3*grav*cos(a2 + a3)*sin(a1 + a2 + a3) + ...
    L1*L2^2*M3^2*R3*grav*cos(a2)*cos(a3)*sin(a1 + a2 + a3) +...
    2*L1*L2^3*M3^2*R3*v1*v2*cos(a2 + a3)*sin(a3) - ...
    L1*L2^3*M3^2*R3*v1^2*cos(a2)*cos(a3)*sin(a3) - ...
    L1*L2^3*M3^2*R3*v2^2*cos(a2)*cos(a3)*sin(a3) + ...
    L1^2*M2*M3*R2^2*R3*v1^2*cos(a2 + a3)*sin(a2 + a3) - ...
    L1^2*L2^2*M3^2*R3*v1^2*cos(a2 + a3)*cos(a3)*sin(a2) - ...
    L1^2*L2^2*M3^2*R3*v1^2*sin(a2 + a3)*cos(a2)*cos(a3) + ...
    L1*L2^2*M3^2*R3^2*v1^2*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    L1*L2^2*M3^2*R3^2*v2^2*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    L1*L2^2*M3^2*R3^2*v3^2*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    L1*L2^2*M3^2*R3*grav*cos(a2 + a3)*sin(a1 + a2)*cos(a3) - ...
    L1*L2^2*M2*M3*R3*grav*cos(a3)^2*sin(a1) - L2^2*M1*M3*R1*R3*grav*cos(a3)^2*sin(a1) +...
    2*L1*M2*M3*R2^2*R3^2*v1*v2*sin(a2 + a3) + 2*L1*M2*M3*R2^2*R3^2*v1*v3*sin(a2 + a3) + ...
    2*L1*M2*M3*R2^2*R3^2*v2*v3*sin(a2 + a3) - 2*L1*L2^2*M3^2*R3^2*v1*v2*cos(a2)*sin(a3) - ...
    2*L1*L2^2*M3^2*R3^2*v1*v3*cos(a2)*sin(a3) - 2*L1*L2^3*M3^2*R3*v1*v2*cos(a3)^2*sin(a2) - ...
    2*L1*L2^2*M3^2*R3^2*v2*v3*cos(a2)*sin(a3) + 2*L1*L2*M2*M3*R2^2*R3*v1*v2*sin(a2) + ...
    2*L1*L2^2*M2*M3*R2*R3*v1*v2*sin(a2) - L1*L2^2*M2*M3*R2*R3*v1^2*cos(a3)^2*sin(a2) - ...
    L1*L2^2*M2*M3*R2*R3*v2^2*cos(a3)^2*sin(a2) - 2*L1*L2^3*M3^2*R3*v1*v2*cos(a2)*cos(a3)*sin(a3) + ...
    2*L1*L2^2*M3^2*R3^2*v1*v2*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    2*L1*L2^2*M3^2*R3^2*v1*v3*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    2*L1*L2^2*M3^2*R3^2*v2*v3*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    L1*L2*M2*M3*R2^2*R3*v1^2*cos(a2 + a3)*sin(a3) + ...
    L1*L2*M2*M3*R2^2*R3*v2^2*cos(a2 + a3)*sin(a3) + ...
    2*L1^2*L2*M2*M3*R2*R3*v1^2*cos(a2)*sin(a2) - L1*L2*M2*M3*R2*R3^2*v1^2*cos(a2)*sin(a3) - ...
    L1*L2*M2*M3*R2*R3^2*v2^2*cos(a2)*sin(a3) - L1*L2*M2*M3*R2*R3^2*v3^2*cos(a2)*sin(a3) - ...
    2*L1*L2*M2*M3*R2*R3*grav*sin(a1 + a2)*cos(a2) + L1*L2*M2*M3*R2*R3*grav*cos(a2)*cos(a3)*sin(a1 + a2 + a3) - ...
    2*L1*L2^2*M2*M3*R2*R3*v1*v2*cos(a3)^2*sin(a2) - L1^2*L2*M2*M3*R2*R3*v1^2*cos(a2 + a3)*cos(a3)*sin(a2) - ...
    L1^2*L2*M2*M3*R2*R3*v1^2*sin(a2 + a3)*cos(a2)*cos(a3) + ...
    L1*L2*M2*M3*R2*R3*grav*cos(a2 + a3)*sin(a1 + a2)*cos(a3) + ...
    2*L1*L2*M2*M3*R2^2*R3*v1*v2*cos(a2 + a3)*sin(a3) - ...
    L1*L2^2*M2*M3*R2*R3*v1^2*cos(a2)*cos(a3)*sin(a3) - ...
    L1*L2^2*M2*M3*R2*R3*v2^2*cos(a2)*cos(a3)*sin(a3) - ...
    2*L1*L2*M2*M3*R2*R3^2*v1*v2*cos(a2)*sin(a3) - 2*L1*L2*M2*M3*R2*R3^2*v1*v3*cos(a2)*sin(a3) - ...
    2*L1*L2*M2*M3*R2*R3^2*v2*v3*cos(a2)*sin(a3) - ...
    2*L1*L2^2*M2*M3*R2*R3*v1*v2*cos(a2)*cos(a3)*sin(a3);
  
  ddt1_denom = (L1^2*L2^2*M3^2*R3 + L1^2*M2^2*R2^2*R3 + L1^2*L2^2*M2*M3*R3 +... 
    L2^2*M1*M3*R1^2*R3 + L1^2*M2*M3*R2^2*R3 + M1*M2*R1^2*R2^2*R3 - ...
    (L1^2*L2^2*M3^2*R3 + L1^2*M2*M3*R2^2*R3)*cos(a2 + a3)^2 -...
    L1^2*L2^2*M3^2*R3*cos(a2)^2 -...
    L1^2*M2^2*R2^2*R3*cos(a2)^2  - ...
    L1^2*L2^2*M2*M3*R3*cos(a3)^2 - L1^2*L2^2*M3^2*R3*cos(a3)^2 - L2^2*M1*M3*R1^2*R3*cos(a3)^2 - ...
    2*L1^2*L2*M2*M3*R2*R3*cos(a2)^2 +  ...
    (2*L1^2*L2^2*M3^2*R3 + 2*L1^2*L2*M2*M3*R2*R3)*cos(a2 + a3)*cos(a2)*cos(a3));





ddt2_num_tau1 = (L2^2*M3*R3  + M2*R2^2*R3 - L2^2*M3*R3*cos(a3)^2 + ...
    (L1*L2*M3*R3+ L1*M2*R2*R3)*cos(a2) - L1*L2*M3*R3*cos(a2 + a3)*cos(a3) );
ddt2_num_tau2 = (-L1^2*M2*R3 - L1^2*M3*R3  - M1*R1^2*R3 - M2*R2^2*R3 + ...
    L1^2*M3*R3*cos(a2 + a3)^2- L2^2*M3*R3 + L2^2*M3*R3*cos(a3)^2 - ...
    2*L1*L2*M3*R3*cos(a2) - 2*L1*M2*R2*R3*cos(a2) + 2*L1*L2*M3*R3*cos(a2 + a3)*cos(a3));
ddt2_num_tau3=(L1^2*M2*R3 + L1^2*M3*R3 + M1*R1^2*R3 - L1^2*M3*R3*cos(a2 + a3)^2 - ...
    L1*L2^2*M3*cos(a2 + a3) - L1*M2*R2^2*cos(a2 + a3) + L1^2*L2*M2*cos(a3) + ...
    L1^2*L2*M3*cos(a3) + L2*M1*R1^2*cos(a3) - L1^2*L2*M3*cos(a2 + a3)*cos(a2) - ...
    L1^2*M2*R2*cos(a2 + a3)*cos(a2) + L1*L2^2*M3*cos(a2)*cos(a3) + ...
    L1*L2*M3*R3*cos(a2)+ L1*M2*R2*R3*cos(a2) - L1*L2*M3*R3*cos(a2 + a3)*cos(a3) + L1*L2*M2*R2*cos(a2)*cos(a3));
ddt2_a_num_general = (- L1^2*L2*M3^2*R3^2*v1^2*sin(a3) - L1^2*L2*M3^2*R3^2*v2^2*sin(a3) - ...
    L1^2*L2*M3^2*R3^2*v3^2*sin(a3) - L1^2*L2*M3^2*R3*grav*sin(a1 + a2) - ...
    L1^2*M2^2*R2*R3*grav*sin(a1 + a2)  + L1*L2^2*M3^2*R3*grav*sin(a1) + ...
    L1*M2^2*R2^2*R3*grav*sin(a1)  + L1*L2^3*M3^2*R3*v1^2*sin(a2) + ...
    L1^3*L2*M3^2*R3*v1^2*sin(a2) + L1*L2^3*M3^2*R3*v2^2*sin(a2) + ...
    L1*M2^2*R2^3*R3*v1^2*sin(a2) + L1^3*M2^2*R2*R3*v1^2*sin(a2) + ...
    L1*M2^2*R2^3*R3*v2^2*sin(a2) + L1*L2^2*M3^2*R3^2*v1^2*sin(a2 + a3) + ...
    L1*L2^2*M3^2*R3^2*v2^2*sin(a2 + a3) + L1*L2^2*M3^2*R3^2*v3^2*sin(a2 + a3) + ...
    2*L1^2*L2^2*M3^2*R3*v1^2*cos(a2)*sin(a2) - L1*L2^2*M3^2*R3^2*v1^2*cos(a2)*sin(a3) + ...
    L1^2*L2^2*M3^2*R3*v2^2*cos(a2)*sin(a2) - L1*L2^2*M3^2*R3^2*v2^2*cos(a2)*sin(a3) - ...
    L1*L2^3*M3^2*R3*v1^2*cos(a3)^2*sin(a2) - L1^2*L2^2*M3^2*R3*v1^2*cos(a3)*sin(a3) - ...
    L1*L2^2*M3^2*R3^2*v3^2*cos(a2)*sin(a3) - L1*L2^3*M3^2*R3*v2^2*cos(a3)^2*sin(a2) - ...
    L1^2*L2^2*M3^2*R3*v2^2*cos(a3)*sin(a3) + 2*L1^2*M2^2*R2^2*R3*v1^2*cos(a2)*sin(a2) + ...
    L1^2*M2^2*R2^2*R3*v2^2*cos(a2)*sin(a2) - L1*L2^2*M3^2*R3*grav*sin(a1 + a2)*cos(a2) - ...
    L1*M2^2*R2^2*R3*grav*sin(a1 + a2)*cos(a2) - L1*L2^2*M3^2*R3^2*v1^2*sin(a2 + a3)*cos(a3)^2 + ...
    L1^2*L2*M3^2*R3^2*v1^2*cos(a2 + a3)^2*sin(a3) - L1*L2^2*M3^2*R3^2*v2^2*sin(a2 + a3)*cos(a3)^2 + ...
    L1^2*L2*M3^2*R3^2*v2^2*cos(a2 + a3)^2*sin(a3) - L1*L2^2*M3^2*R3^2*v3^2*sin(a2 + a3)*cos(a3)^2 + ...
    L1^2*L2*M3^2*R3^2*v3^2*cos(a2 + a3)^2*sin(a3) - L1^2*L2*M2*M3*R3^2*v1^2*sin(a3) - ...
    L1^2*L2*M2*M3*R3^2*v2^2*sin(a3) - L1^2*L2*M2*M3*R3^2*v3^2*sin(a3) - ...
    L2*M1*M3*R1^2*R3^2*v1^2*sin(a3) - L2*M1*M3*R1^2*R3^2*v2^2*sin(a3) - ...
    L2*M1*M3*R1^2*R3^2*v3^2*sin(a3) - 2*L1^2*L2*M3^2*R3^2*v1*v2*sin(a3) - ...
    2*L1^2*L2*M3^2*R3^2*v1*v3*sin(a3) - 2*L1^2*L2*M3^2*R3^2*v2*v3*sin(a3) +...
    L1^2*L2*M3^2*R3*grav*cos(a2 + a3)^2*sin(a1 + a2) - L1*L2^2*M3^2*R3*grav*cos(a2 + a3)*sin(a1 + a2 + a3) - ...
    L1^2*L2*M2*M3*R3*grav*sin(a1 + a2) - L2*M1*M3*R1^2*R3*grav*sin(a1 + a2) - ...
    L1^2*M2*M3*R2*R3*grav*sin(a1 + a2) - M1*M2*R1^2*R2*R3*grav*sin(a1 + a2)   + ...
    L1^2*L2*M3^2*R3*grav*cos(a2)*sin(a1) + L1^2*M2^2*R2*R3*grav*cos(a2)*sin(a1) +...
    L1*L2^3*M3^2*R3*v1^2*cos(a2 + a3)*sin(a3) - L1^3*L2*M3^2*R3*v1^2*sin(a2 + a3)*cos(a3) + ...
    L1*L2^3*M3^2*R3*v2^2*cos(a2 + a3)*sin(a3) + L1^2*L2*M3^2*R3*grav*cos(a3)*sin(a1 + a2 + a3) +...
    L1*L2^2*M2*M3*R3*grav*sin(a1) + L2^2*M1*M3*R1*R3*grav*sin(a1) + L1*M2*M3*R2^2*R3*grav*sin(a1) + ...
    L1^2*L2^2*M3^2*R3*v1^2*cos(a2 + a3)*sin(a2 + a3) + M1*M2*R1*R2^2*R3*grav*sin(a1)  -...
    L1*L2^2*M3^2*R3*grav*cos(a3)^2*sin(a1) + L1^2*L2*M3^2*R3^2*v1^2*sin(a2 + a3)*cos(a2) + ...
    L1^2*L2*M3^2*R3^2*v2^2*sin(a2 + a3)*cos(a2) - L1^3*L2*M3^2*R3*v1^2*cos(a2 + a3)^2*sin(a2) +...
    L1^2*L2*M3^2*R3^2*v3^2*sin(a2 + a3)*cos(a2) + L1^3*L2*M2*M3*R3*v1^2*sin(a2) +...
    L1^3*M2*M3*R2*R3*v1^2*sin(a2) + 2*L1*L2^3*M3^2*R3*v1*v2*sin(a2) + ...
    2*L1*M2^2*R2^3*R3*v1*v2*sin(a2) + L1*M2*M3*R2^2*R3^2*v1^2*sin(a2 + a3) +...
    L1*M2*M3*R2^2*R3^2*v2^2*sin(a2 + a3) + L1*M2*M3*R2^2*R3^2*v3^2*sin(a2 + a3) + ...
    2*L1*L2^2*M3^2*R3^2*v1*v2*sin(a2 + a3) + 2*L1*L2^2*M3^2*R3^2*v1*v3*sin(a2 + a3) + ...
    2*L1*L2^2*M3^2*R3^2*v2*v3*sin(a2 + a3) + 2*L1^2*M2^2*R2^2*R3*v1*v2*cos(a2)*sin(a2) - ...
    2*L1*L2^2*M3^2*R3^2*v1*v2*sin(a2 + a3)*cos(a3)^2 + 2*L1^2*L2*M3^2*R3^2*v1*v2*cos(a2 + a3)^2*sin(a3) - ...
    2*L1*L2^2*M3^2*R3^2*v1*v3*sin(a2 + a3)*cos(a3)^2 + 2*L1^2*L2*M3^2*R3^2*v1*v3*cos(a2 + a3)^2*sin(a3) - ...
    2*L1*L2^2*M3^2*R3^2*v2*v3*sin(a2 + a3)*cos(a3)^2 + 2*L1^2*L2*M3^2*R3^2*v2*v3*cos(a2 + a3)^2*sin(a3) +...
    L1*L2*M1*M3*R1^2*R3*v1^2*sin(a2) + L1*L2*M2*M3*R2^2*R3*v1^2*sin(a2) + L1*L2^2*M2*M3*R2*R3*v1^2*sin(a2) + ...
    L1*L2*M2*M3*R2^2*R3*v2^2*sin(a2) + L1*L2^2*M2*M3*R2*R3*v2^2*sin(a2) - 2*L1^2*L2*M2*M3*R3^2*v1*v2*sin(a3) -...
    2*L1^2*L2*M2*M3*R3^2*v1*v3*sin(a3) - 2*L1^2*L2*M2*M3*R3^2*v2*v3*sin(a3) + L1*M1*M2*R1^2*R2*R3*v1^2*sin(a2) - ...
    2*L2*M1*M3*R1^2*R3^2*v1*v2*sin(a3) - 2*L2*M1*M3*R1^2*R3^2*v1*v3*sin(a3) - ...
    2*L2*M1*M3*R1^2*R3^2*v2*v3*sin(a3) + L1^2*M2*M3*R2*R3*grav*cos(a2 + a3)^2*sin(a1 + a2) - ...
    L1*M2*M3*R2^2*R3*grav*cos(a2 + a3)*sin(a1 + a2 + a3) + L1*L2^2*M3^2*R3*grav*cos(a2)*cos(a3)*sin(a1 + a2 + a3));


ddt2_b_num_general = -(L1^2*L2*M2*M3*R3*grav*cos(a2)*sin(a1) + L1^2*M2*M3*R2*R3*grav*cos(a2)*sin(a1) - ...
    L1^2*L2*M3^2*R3^2*v1^2*cos(a2 + a3)*sin(a2 + a3)*cos(a3) - ...
    L1^2*L2*M3^2*R3^2*v2^2*cos(a2 + a3)*sin(a2 + a3)*cos(a3) - ...
    L1^2*L2*M3^2*R3^2*v3^2*cos(a2 + a3)*sin(a2 + a3)*cos(a3) - ...
    L1^3*L2*M2*M3*R3*v1^2*sin(a2 + a3)*cos(a3) + 2*L1*L2^3*M3^2*R3*v1*v2*cos(a2 + a3)*sin(a3) + ...
    L1^2*L2*M2*M3*R3*grav*cos(a3)*sin(a1 + a2 + a3) - L1*L2^3*M3^2*R3*v1^2*cos(a2)*cos(a3)*sin(a3) - ...
    L1*L2^3*M3^2*R3*v2^2*cos(a2)*cos(a3)*sin(a3) + L2*M1*M3*R1^2*R3*grav*cos(a3)*sin(a1 + a2 + a3) + ...
    L1^2*M2*M3*R2^2*R3*v1^2*cos(a2 + a3)*sin(a2 + a3) + L1^2*L2^2*M3^2*R3*v1^2*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    2*L1^2*L2^2*M3^2*R3*v1^2*cos(a2 + a3)*cos(a3)*sin(a2) - ...
    L1^2*L2^2*M3^2*R3*v1^2*sin(a2 + a3)*cos(a2)*cos(a3) + L1*L2^2*M3^2*R3^2*v1^2*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    L1^2*L2^2*M3^2*R3*v2^2*cos(a2 + a3)*cos(a2)*sin(a3) - L1^2*L2^2*M3^2*R3*v2^2*cos(a2 + a3)*cos(a3)*sin(a2) + ...
    L1*L2^2*M3^2*R3^2*v2^2*cos(a2 + a3)*cos(a3)*sin(a3) + L1*L2^2*M3^2*R3^2*v3^2*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    L1*L2^2*M3^2*R3*grav*cos(a2 + a3)*sin(a1 + a2)*cos(a3) - L1*L2^2*M2*M3*R3*grav*cos(a3)^2*sin(a1) - ...
    L2^2*M1*M3*R1*R3*grav*cos(a3)^2*sin(a1) + L1^2*M2*M3*R2*R3^2*v1^2*sin(a2 + a3)*cos(a2) + ...
    L1^2*M2*M3*R2*R3^2*v2^2*sin(a2 + a3)*cos(a2) - L1^3*M2*M3*R2*R3*v1^2*cos(a2 + a3)^2*sin(a2) +...
    L1^2*M2*M3*R2*R3^2*v3^2*sin(a2 + a3)*cos(a2) + 2*L1^2*L2*M3^2*R3^2*v1*v2*sin(a2 + a3)*cos(a2) +...
    2*L1^2*L2*M3^2*R3^2*v1*v3*sin(a2 + a3)*cos(a2) + 2*L1^2*L2*M3^2*R3^2*v2*v3*sin(a2 + a3)*cos(a2) - ...
    L1^2*L2*M3^2*R3*grav*cos(a2 + a3)*cos(a3)*sin(a1) + 2*L1*M2*M3*R2^2*R3^2*v1*v2*sin(a2 + a3) + ...
    2*L1*M2*M3*R2^2*R3^2*v1*v3*sin(a2 + a3) + 2*L1*M2*M3*R2^2*R3^2*v2*v3*sin(a2 + a3) + ...
    L1^3*L2*M3^2*R3*v1^2*cos(a2 + a3)*sin(a2 + a3)*cos(a2) - L1^2*L2^2*M2*M3*R3*v1^2*cos(a3)*sin(a3) - ...
    L1^2*L2^2*M2*M3*R3*v2^2*cos(a3)*sin(a3) - L2^2*M1*M3*R1^2*R3*v1^2*cos(a3)*sin(a3) - ...
    L2^2*M1*M3*R1^2*R3*v2^2*cos(a3)*sin(a3) + 2*L1^2*L2^2*M3^2*R3*v1*v2*cos(a2)*sin(a2) - ...
    2*L1*L2^2*M3^2*R3^2*v1*v2*cos(a2)*sin(a3) - 2*L1*L2^2*M3^2*R3^2*v1*v3*cos(a2)*sin(a3) - ...
    2*L1*L2^3*M3^2*R3*v1*v2*cos(a3)^2*sin(a2) - 2*L1^2*L2^2*M3^2*R3*v1*v2*cos(a3)*sin(a3) - ...
    2*L1*L2^2*M3^2*R3^2*v2*v3*cos(a2)*sin(a3) - L1^2*L2*M3^2*R3*grav*cos(a2 + a3)*cos(a2)*sin(a1 + a2 + a3) + ...
    2*L1*L2*M2*M3*R2^2*R3*v1*v2*sin(a2) + 2*L1*L2^2*M2*M3*R2*R3*v1*v2*sin(a2) + ...
    L1*L2*M1*M3*R1*R3*grav*cos(a2)*sin(a1) + L1*M1*M2*R1*R2*R3*grav*cos(a2)*sin(a1) - ...
    2*L1^2*L2*M3^2*R3^2*v1*v2*cos(a2 + a3)*sin(a2 + a3)*cos(a3) - ...
    2*L1^2*L2*M3^2*R3^2*v1*v3*cos(a2 + a3)*sin(a2 + a3)*cos(a3) - ...
    2*L1^2*L2*M3^2*R3^2*v2*v3*cos(a2 + a3)*sin(a2 + a3)*cos(a3) - ...
    L1*L2^2*M2*M3*R2*R3*v1^2*cos(a3)^2*sin(a2) - L1*L2^2*M2*M3*R2*R3*v2^2*cos(a3)^2*sin(a2) - ...
    2*L1*L2^3*M3^2*R3*v1*v2*cos(a2)*cos(a3)*sin(a3) + 2*L1^2*L2^2*M3^2*R3*v1*v2*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    2*L1^2*L2^2*M3^2*R3*v1*v2*cos(a2 + a3)*cos(a3)*sin(a2) + ...
    2*L1*L2^2*M3^2*R3^2*v1*v2*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    2*L1*L2^2*M3^2*R3^2*v1*v3*cos(a2 + a3)*cos(a3)*sin(a3) + ...
    2*L1*L2^2*M3^2*R3^2*v2*v3*cos(a2 + a3)*cos(a3)*sin(a3) - ...
    L1*L2*M1*M3*R1^2*R3*v1^2*sin(a2 + a3)*cos(a3) + ...
    L1*L2*M2*M3*R2^2*R3*v1^2*cos(a2 + a3)*sin(a3) + ...
    L1*L2*M2*M3*R2^2*R3*v2^2*cos(a2 + a3)*sin(a3) + 2*L1^2*M2*M3*R2*R3^2*v1*v2*sin(a2 + a3)*cos(a2) +...
    2*L1^2*M2*M3*R2*R3^2*v1*v3*sin(a2 + a3)*cos(a2) + 2*L1^2*M2*M3*R2*R3^2*v2*v3*sin(a2 + a3)*cos(a2) - ...
    L1^2*L2*M2*M3*R3*grav*cos(a2 + a3)*cos(a3)*sin(a1) + L1^3*M2*M3*R2*R3*v1^2*cos(a2 + a3)*sin(a2 + a3)*cos(a2) + ...
    4*L1^2*L2*M2*M3*R2*R3*v1^2*cos(a2)*sin(a2) - L1*L2*M2*M3*R2*R3^2*v1^2*cos(a2)*sin(a3) + ...
    2*L1^2*L2*M2*M3*R2*R3*v2^2*cos(a2)*sin(a2) - L1*L2*M2*M3*R2*R3^2*v2^2*cos(a2)*sin(a3) - ...
    L1*L2*M2*M3*R2*R3^2*v3^2*cos(a2)*sin(a3) - 2*L1^2*L2^2*M2*M3*R3*v1*v2*cos(a3)*sin(a3) - ...
    2*L2^2*M1*M3*R1^2*R3*v1*v2*cos(a3)*sin(a3) - L1^2*M2*M3*R2*R3*grav*cos(a2 + a3)*cos(a2)*sin(a1 + a2 + a3) - ...
    2*L1*L2*M2*M3*R2*R3*grav*sin(a1 + a2)*cos(a2) + L1*L2*M2*M3*R2*R3*grav*cos(a2)*cos(a3)*sin(a1 + a2 + a3) - ...
    2*L1*L2^2*M2*M3*R2*R3*v1*v2*cos(a3)^2*sin(a2) + L1^2*L2*M2*M3*R2*R3*v1^2*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    2*L1^2*L2*M2*M3*R2*R3*v1^2*cos(a2 + a3)*cos(a3)*sin(a2) - L1^2*L2*M2*M3*R2*R3*v1^2*sin(a2 + a3)*cos(a2)*cos(a3) + ...
    L1^2*L2*M2*M3*R2*R3*v2^2*cos(a2 + a3)*cos(a2)*sin(a3) - L1^2*L2*M2*M3*R2*R3*v2^2*cos(a2 + a3)*cos(a3)*sin(a2) + ...
    L1*L2*M2*M3*R2*R3*grav*cos(a2 + a3)*sin(a1 + a2)*cos(a3) + 2*L1*L2*M2*M3*R2^2*R3*v1*v2*cos(a2 + a3)*sin(a3) -...
    L1*L2^2*M2*M3*R2*R3*v1^2*cos(a2)*cos(a3)*sin(a3) - L1*L2^2*M2*M3*R2*R3*v2^2*cos(a2)*cos(a3)*sin(a3) - ...
    L1*L2*M1*M3*R1*R3*grav*cos(a2 + a3)*cos(a3)*sin(a1) + 4*L1^2*L2*M2*M3*R2*R3*v1*v2*cos(a2)*sin(a2) - ...
    2*L1*L2*M2*M3*R2*R3^2*v1*v2*cos(a2)*sin(a3) - 2*L1*L2*M2*M3*R2*R3^2*v1*v3*cos(a2)*sin(a3) - ...
    2*L1*L2*M2*M3*R2*R3^2*v2*v3*cos(a2)*sin(a3) + 2*L1^2*L2*M2*M3*R2*R3*v1*v2*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    2*L1^2*L2*M2*M3*R2*R3*v1*v2*cos(a2 + a3)*cos(a3)*sin(a2) - 2*L1*L2^2*M2*M3*R2*R3*v1*v2*cos(a2)*cos(a3)*sin(a3));
 
ddt2_denom = (L1^2*L2^2*M3^2*R3 + L1^2*M2^2*R2^2*R3 - L1^2*L2^2*M3^2*R3*cos(a2 + a3)^2 + ...
    L1^2*L2^2*M2*M3*R3 + L2^2*M1*M3*R1^2*R3 + L1^2*M2*M3*R2^2*R3 + M1*M2*R1^2*R2^2*R3 - ...
    L1^2*L2^2*M3^2*R3*cos(a2)^2 - L1^2*L2^2*M3^2*R3*cos(a3)^2 - L1^2*M2^2*R2^2*R3*cos(a2)^2 - ...
    L1^2*M2*M3*R2^2*R3*cos(a2 + a3)^2 - L1^2*L2^2*M2*M3*R3*cos(a3)^2 - L2^2*M1*M3*R1^2*R3*cos(a3)^2 - ...
    2*L1^2*L2*M2*M3*R2*R3*cos(a2)^2 + 2*L1^2*L2^2*M3^2*R3*cos(a2 + a3)*cos(a2)*cos(a3) + ...
    2*L1^2*L2*M2*M3*R2*R3*cos(a2 + a3)*cos(a2)*cos(a3));


  
ddt3_num_tau1 =  (L1*L2^2*M3^2*R3*cos(a2 + a3) - L1*L2*M3^2*R3^2*cos(a2) + ...
    L1*L2*M3^2*R3^2*cos(a2 + a3)*cos(a3) + L1*M2*M3*R2^2*R3*cos(a2 + a3) - ...
    L1*L2^2*M3^2*R3*cos(a2)*cos(a3) - L1*L2*M2*M3*R2*R3*cos(a2)*cos(a3)) ;
ddt3_num_tau2 = (L1^2*M3^2*R3^2 - L1^2*M3^2*R3^2*cos(a2 + a3)^2 + L1^2*M2*M3*R3^2 +...
    M1*M3*R1^2*R3^2 - L1*L2^2*M3^2*R3*cos(a2 + a3)  + L1*L2*M3^2*R3^2*cos(a2) + ...
    L1^2*L2*M3^2*R3*cos(a3) - L1^2*L2*M3^2*R3*cos(a2 + a3)*cos(a2) - ...
    L1*L2*M3^2*R3^2*cos(a2 + a3)*cos(a3) - L1*M2*M3*R2^2*R3*cos(a2 + a3) + ...
    L1*L2^2*M3^2*R3*cos(a2)*cos(a3) + L1^2*L2*M2*M3*R3*cos(a3) + ...
    L1*M2*M3*R2*R3^2*cos(a2) + L2*M1*M3*R1^2*R3*cos(a3) - ...
    L1^2*M2*M3*R2*R3*cos(a2 + a3)*cos(a2) + L1*L2*M2*M3*R2*R3*cos(a2)*cos(a3));
ddt3_num_tau3 = (-L1^2*M2^2*R2^2- L1^2*L2^2*M3^2 - L1^2*M3^2*R3^2 + ...
    L1^2*M2^2*R2^2*cos(a2)^2 + L1^2*M3^2*R3^2*cos(a2 + a3)^2 - L1^2*L2^2*M2*M3 - ...
    L2^2*M1*M3*R1^2 - L1^2*M2*M3*R2^2 - L1^2*M2*M3*R3^2- M1*M2*R1^2*R2^2  - ...
    M1*M3*R1^2*R3^2 + L1^2*L2^2*M3^2*cos(a2)^2 - 2*L1^2*L2*M3^2*R3*cos(a3) + ...
    2*L1^2*L2*M3^2*R3*cos(a2 + a3)*cos(a2) - 2*L1^2*L2*M2*M3*R3*cos(a3)  - ...
    2*L2*M1*M3*R1^2*R3*cos(a3) + 2*L1^2*L2*M2*M3*R2*cos(a2)^2 + ...
    2*L1^2*M2*M3*R2*R3*cos(a2 + a3)*cos(a2));
ddt3_a_num_general = (- L1^2*L2^2*M3^3*R3*grav*sin(a1 + a2 + a3) - L1^3*L2*M3^3*R3^2*V1^2*sin(a2) +...
    L1^2*L2*M3^3*R3^3*V1^2*sin(a3) + L1^2*L2^3*M3^3*R3*V1^2*sin(a3) + ...
    L1^2*L2*M3^3*R3^3*V2^2*sin(a3) + L1^2*L2^3*M3^3*R3*V2^2*sin(a3) + ...
    L1^2*L2*M3^3*R3^3*V3^2*sin(a3)   + L1^2*L2*M3^3*R3^2*grav*sin(a1 + a2) + ...
    L1^3*L2^2*M3^3*R3*V1^2*sin(a2 + a3) - L1^3*L2^2*M3^3*R3*V1^2*cos(a3)*sin(a2) + ...
    L2*M1*M3^2*R1^2*R3^2*grav*sin(a1 + a2) + L1^2*M2*M3^2*R2*R3^2*grav*sin(a1 + a2) + ...
    L1^2*M2^2*M3*R2*R3^2*grav*sin(a1 + a2) + L1^3*L2*M3^3*R3^2*V1^2*cos(a2 + a3)^2*sin(a2) - ...
    L1^3*L2^2*M3^3*R3*V1^2*sin(a2 + a3)*cos(a2)^2 - L1^2*L2*M3^3*R3^3*V1^2*cos(a2 + a3)^2*sin(a3) - ...
    L1^2*L2*M3^3*R3^3*V2^2*cos(a2 + a3)^2*sin(a3) - L1^2*L2*M3^3*R3^3*V3^2*cos(a2 + a3)^2*sin(a3) + ...
    2*L1^2*L2*M3^3*R3^3*V1*V2*sin(a3) + 2*L1^2*L2^3*M3^3*R3*V1*V2*sin(a3) + ...
    2*L1^2*L2*M3^3*R3^3*V1*V3*sin(a3) + 2*L1^2*L2*M3^3*R3^3*V2*V3*sin(a3) + ...
    L1^2*L2^2*M3^3*R3*grav*cos(a2)^2*sin(a1 + a2 + a3) + L1^3*L2^2*M2*M3^2*R3*V1^2*sin(a2 + a3) +...
    L1^3*M2*M3^2*R2^2*R3*V1^2*sin(a2 + a3) + L1^3*M2^2*M3*R2^2*R3*V1^2*sin(a2 + a3) - ...
    L1^2*L2^2*M2*M3^2*R3*grav*sin(a1 + a2 + a3) - L1^2*L2^2*M3^3*R3^2*V1^2*cos(a2)*sin(a2) - ...
    L1^2*L2^2*M3^3*R3^2*V2^2*cos(a2)*sin(a2) + 2*L1^2*L2^2*M3^3*R3^2*V1^2*cos(a3)*sin(a3) - ...
    L1^2*L2^3*M3^3*R3*V1^2*cos(a2)^2*sin(a3) + 2*L1^2*L2^2*M3^3*R3^2*V2^2*cos(a3)*sin(a3) - ...
    L1^2*L2^3*M3^3*R3*V2^2*cos(a2)^2*sin(a3) + L1^2*L2^2*M3^3*R3^2*V3^2*cos(a3)*sin(a3) - ...
    L2^2*M1*M3^2*R1^2*R3*grav*sin(a1 + a2 + a3) - L1^2*M2*M3^2*R2^2*R3*grav*sin(a1 + a2 + a3) - ...
    L1^2*M2^2*M3*R2^2*R3*grav*sin(a1 + a2 + a3) + L1^2*L2^2*M3^3*R3*grav*cos(a2 + a3)*sin(a1) + ...
    L1^2*L2^2*M3^3*R3*grav*sin(a1 + a2)*cos(a3)  - L1^3*L2*M2*M3^2*R3^2*V1^2*sin(a2) + ...
    L1^2*L2*M2*M3^2*R3^3*V1^2*sin(a3) + L1^2*L2^3*M2*M3^2*R3*V1^2*sin(a3) + ...
    L1^2*L2*M2*M3^2*R3^3*V2^2*sin(a3) + L1^2*L2^3*M2*M3^2*R3*V2^2*sin(a3) + ...
    L1^2*L2*M2*M3^2*R3^3*V3^2*sin(a3) + L2*M1*M3^2*R1^2*R3^3*V1^2*sin(a3) - ...
    L1^3*M2*M3^2*R2*R3^2*V1^2*sin(a2) - L1^3*M2^2*M3*R2*R3^2*V1^2*sin(a2) + ...
    L2^3*M1*M3^2*R1^2*R3*V1^2*sin(a3) + L2*M1*M3^2*R1^2*R3^3*V2^2*sin(a3) + ...
    L2^3*M1*M3^2*R1^2*R3*V2^2*sin(a3) + L2*M1*M3^2*R1^2*R3^3*V3^2*sin(a3) - ...
    L1^2*L2*M3^3*R3^2*grav*cos(a2 + a3)^2*sin(a1 + a2) - L1^2*L2*M3^3*R3^2*grav*cos(a2)*sin(a1) - ...
    L1^2*L2*M3^3*R3^3*V1^2*sin(a2 + a3)*cos(a2) + L1^2*L2^3*M3^3*R3*V1^2*cos(a2 + a3)*sin(a2) - ...
    L1^2*L2*M3^3*R3^3*V2^2*sin(a2 + a3)*cos(a2) + L1^2*L2^3*M3^3*R3*V2^2*cos(a2 + a3)*sin(a2) + ...
    L1^3*L2*M3^3*R3^2*V1^2*sin(a2 + a3)*cos(a3) - L1^2*L2*M3^3*R3^3*V3^2*sin(a2 + a3)*cos(a2) - ...
    L1^2*L2*M3^3*R3^2*grav*cos(a3)*sin(a1 + a2 + a3)  + L1^2*L2^2*M3^3*R3^2*V1^2*cos(a2 + a3)*sin(a2 + a3) + ...
    L1^2*L2^2*M3^3*R3^2*V2^2*cos(a2 + a3)*sin(a2 + a3) + L1^2*L2^2*M3^3*R3^2*V3^2*cos(a2 + a3)*sin(a2 + a3) + ...
    L1^2*L2*M2*M3^2*R3^2*grav*sin(a1 + a2) - L1^2*L2*M2*M3^2*R3^2*grav*cos(a2)*sin(a1) - ...
    L1^2*M2*M3^2*R2*R3^2*grav*cos(a2)*sin(a1) - L1^2*M2^2*M3*R2*R3^2*grav*cos(a2)*sin(a1) + ...
    L1^3*L2*M2*M3^2*R3^2*V1^2*sin(a2 + a3)*cos(a3) - L1^2*M2*M3^2*R2*R3^3*V1^2*sin(a2 + a3)*cos(a2) + ...
    L1^2*M2^2*M3*R2^3*R3*V1^2*cos(a2 + a3)*sin(a2) - L1^2*M2*M3^2*R2*R3^3*V2^2*sin(a2 + a3)*cos(a2) + ...
    L1^2*M2^2*M3*R2^3*R3*V2^2*cos(a2 + a3)*sin(a2) - L1^2*M2*M3^2*R2*R3^3*V3^2*sin(a2 + a3)*cos(a2) - ...
    2*L1^2*L2*M3^3*R3^3*V1*V2*cos(a2 + a3)^2*sin(a3) - 2*L1^2*L2*M3^3*R3^3*V1*V3*cos(a2 + a3)^2*sin(a3) - ...
    2*L1^2*L2*M3^3*R3^3*V2*V3*cos(a2 + a3)^2*sin(a3) - L1^2*L2*M2*M3^2*R3^2*grav*cos(a3)*sin(a1 + a2 + a3) - ...
    L2*M1*M3^2*R1^2*R3^2*grav*cos(a3)*sin(a1 + a2 + a3) + L1^2*M2*M3^2*R2^2*R3^2*V1^2*cos(a2 + a3)*sin(a2 + a3));


    
ddt3_b_num_general = -(L1^2*M2*M3^2*R2^2*R3^2*V2^2*cos(a2 + a3)*sin(a2 + a3) + ...
    L1^2*M2*M3^2*R2^2*R3^2*V3^2*cos(a2 + a3)*sin(a2 + a3) + ...
    L1^2*L2*M3^3*R3^2*grav*cos(a2 + a3)*cos(a3)*sin(a1) - ...
    L1^3*L2*M3^3*R3^2*V1^2*cos(a2 + a3)*sin(a2 + a3)*cos(a2) + ...
    L1^2*L2*M3^3*R3^3*V1^2*cos(a2 + a3)*sin(a2 + a3)*cos(a3) + ...
    L1^2*L2*M3^3*R3^3*V2^2*cos(a2 + a3)*sin(a2 + a3)*cos(a3) + ...
    L1^2*L2*M3^3*R3^3*V3^2*cos(a2 + a3)*sin(a2 + a3)*cos(a3) - ...
    L1^3*L2^2*M2*M3^2*R3*V1^2*cos(a3)*sin(a2) - M1*M2*M3*R1^2*R2^2*R3*grav*sin(a1 + a2 + a3) - ...
    2*L1^2*L2^2*M3^3*R3^2*V1*V2*cos(a2)*sin(a2) + 4*L1^2*L2^2*M3^3*R3^2*V1*V2*cos(a3)*sin(a3) - ...
    2*L1^2*L2^3*M3^3*R3*V1*V2*cos(a2)^2*sin(a3) + 2*L1^2*L2^2*M3^3*R3^2*V1*V3*cos(a3)*sin(a3) + ...
    2*L1^2*L2^2*M3^3*R3^2*V2*V3*cos(a3)*sin(a3) + ...
    L1^2*L2*M3^3*R3^2*grav*cos(a2 + a3)*cos(a2)*sin(a1 + a2 + a3) + ...
    L1^3*M2*M3^2*R2*R3^2*V1^2*cos(a2 + a3)^2*sin(a2) - ...
    L1^3*M2^2*M3*R2^2*R3*V1^2*sin(a2 + a3)*cos(a2)^2 - ...
    L1^2*L2^2*M3^3*R3*grav*cos(a2)*cos(a3)*sin(a1) + 2*L1^2*L2*M2*M3^2*R3^3*V1*V2*sin(a3) + ...
    2*L1^2*L2^3*M2*M3^2*R3*V1*V2*sin(a3) + 2*L1^2*L2*M2*M3^2*R3^3*V1*V3*sin(a3) + ...
    2*L1^2*L2*M2*M3^2*R3^3*V2*V3*sin(a3) + 2*L2*M1*M3^2*R1^2*R3^3*V1*V2*sin(a3) + ...
    2*L2^3*M1*M3^2*R1^2*R3*V1*V2*sin(a3) + 2*L2*M1*M3^2*R1^2*R3^3*V1*V3*sin(a3) + ...
    2*L2*M1*M3^2*R1^2*R3^3*V2*V3*sin(a3) + L1^3*L2^2*M3^3*R3*V1^2*cos(a2 + a3)*cos(a2)*sin(a2) + ...
    L1^2*M2^2*M3*R2^2*R3*grav*cos(a2)^2*sin(a1 + a2 + a3) + L1*L2^2*M1*M3^2*R1^2*R3*V1^2*sin(a2 + a3) + ...
    2*L1^2*L2^2*M2*M3^2*R3^2*V1^2*cos(a3)*sin(a3) + 2*L1^2*L2^2*M2*M3^2*R3^2*V2^2*cos(a3)*sin(a3) + ...
    L1^2*L2^2*M2*M3^2*R3^2*V3^2*cos(a3)*sin(a3) - L1^2*M2^2*M3*R2^2*R3^2*V1^2*cos(a2)*sin(a2) - ...
    L1^2*M2^2*M3*R2^2*R3^2*V2^2*cos(a2)*sin(a2) + 2*L2^2*M1*M3^2*R1^2*R3^2*V1^2*cos(a3)*sin(a3) + ...
    2*L2^2*M1*M3^2*R1^2*R3^2*V2^2*cos(a3)*sin(a3) + L2^2*M1*M3^2*R1^2*R3^2*V3^2*cos(a3)*sin(a3) - ...
    2*L1^2*L2*M3^3*R3^3*V1*V2*sin(a2 + a3)*cos(a2) + 2*L1^2*L2^3*M3^3*R3*V1*V2*cos(a2 + a3)*sin(a2) - ...
    2*L1^2*L2*M3^3*R3^3*V1*V3*sin(a2 + a3)*cos(a2) - 2*L1^2*L2*M3^3*R3^3*V2*V3*sin(a2 + a3)*cos(a2) + ...
    L1^2*L2^2*M2*M3^2*R3*grav*cos(a2 + a3)*sin(a1) + L1^2*L2^2*M2*M3^2*R3*grav*sin(a1 + a2)*cos(a3) - ...
    L1^2*L2^3*M3^3*R3*V1^2*cos(a2)*cos(a3)*sin(a2) - L1^2*L2^3*M3^3*R3*V2^2*cos(a2)*cos(a3)*sin(a2) + ...
    L2^2*M1*M3^2*R1^2*R3*grav*sin(a1 + a2)*cos(a3) + L1^2*M2*M3^2*R2^2*R3*grav*cos(a2 + a3)*sin(a1) + ...
    L1^2*M2^2*M3*R2^2*R3*grav*cos(a2 + a3)*sin(a1) + 2*L1^2*L2^2*M3^3*R3^2*V1*V2*cos(a2 + a3)*sin(a2 + a3) + ...
    2*L1^2*L2^2*M3^3*R3^2*V1*V3*cos(a2 + a3)*sin(a2 + a3) + 2*L1^2*L2^2*M3^3*R3^2*V2*V3*cos(a2 + a3)*sin(a2 + a3) - ...
    L1*L2*M1*M3^2*R1^2*R3^2*V1^2*sin(a2) + L1^2*L2*M2*M3^2*R2^2*R3*V1^2*sin(a3) + ...
    L1^2*L2*M2^2*M3*R2^2*R3*V1^2*sin(a3) + L1^2*L2*M2*M3^2*R2^2*R3*V2^2*sin(a3) + ...
    L1^2*L2*M2^2*M3*R2^2*R3*V2^2*sin(a3) - 2*L1^2*L2^2*M3^3*R3^2*V1^2*cos(a2 + a3)*cos(a2)*sin(a3) + ...
    L1^2*L2^2*M3^3*R3^2*V1^2*cos(a2 + a3)*cos(a3)*sin(a2) - L1^2*L2^2*M3^3*R3^2*V1^2*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    2*L1^2*L2^2*M3^3*R3^2*V2^2*cos(a2 + a3)*cos(a2)*sin(a3) + L1^2*L2^2*M3^3*R3^2*V2^2*cos(a2 + a3)*cos(a3)*sin(a2) - ...
    L1^2*L2^2*M3^3*R3^2*V2^2*sin(a2 + a3)*cos(a2)*cos(a3) - L1^2*L2^2*M3^3*R3^2*V3^2*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    L1^2*L2^2*M3^3*R3^2*V3^2*sin(a2 + a3)*cos(a2)*cos(a3) - L1^2*M2*M3^2*R2*R3^2*grav*cos(a2 + a3)^2*sin(a1 + a2) + ...
    M1*M2*M3*R1^2*R2*R3^2*grav*sin(a1 + a2) - L1^2*L2^2*M3^3*R3*grav*cos(a2 + a3)*sin(a1 + a2)*cos(a2) - ...
    L1^2*L2*M2^2*M3*R2^2*R3*V1^2*cos(a2)^2*sin(a3) - 2*L1^2*L2^2*M2*M3^2*R2*R3*V1^2*cos(a2)^2*sin(a3) - ...
    L1^2*L2*M2^2*M3*R2^2*R3*V2^2*cos(a2)^2*sin(a3) - 2*L1^2*L2^2*M2*M3^2*R2*R3*V2^2*cos(a2)^2*sin(a3) - ...
    2*L1^2*M2*M3^2*R2*R3^3*V1*V2*sin(a2 + a3)*cos(a2) + 2*L1^2*M2^2*M3*R2^3*R3*V1*V2*cos(a2 + a3)*sin(a2) - ...
    2*L1^2*M2*M3^2*R2*R3^3*V1*V3*sin(a2 + a3)*cos(a2) - 2*L1^2*M2*M3^2*R2*R3^3*V2*V3*sin(a2 + a3)*cos(a2) + ...
    2*L1^2*M2*M3^2*R2^2*R3^2*V1*V2*cos(a2 + a3)*sin(a2 + a3) + ...
    2*L1^2*M2*M3^2*R2^2*R3^2*V1*V3*cos(a2 + a3)*sin(a2 + a3) + ...
    2*L1^2*M2*M3^2*R2^2*R3^2*V2*V3*cos(a2 + a3)*sin(a2 + a3)  + ...
    2*L1^2*L2*M3^3*R3^3*V1*V2*cos(a2 + a3)*sin(a2 + a3)*cos(a3) + ...
    2*L1^2*L2*M3^3*R3^3*V1*V3*cos(a2 + a3)*sin(a2 + a3)*cos(a3) + ...
    2*L1^2*L2*M3^3*R3^3*V2*V3*cos(a2 + a3)*sin(a2 + a3)*cos(a3) - ...
    L1^3*L2*M2*M3^2*R2*R3*V1^2*cos(a3)*sin(a2) - L1^3*L2*M2^2*M3*R2*R3*V1^2*cos(a3)*sin(a2) - ...
    L1^2*M2^2*M3*R2^2*R3*grav*cos(a2 + a3)*sin(a1 + a2)*cos(a2) + ...
    L1*L2*M1*M3^2*R1^2*R3^2*V1^2*sin(a2 + a3)*cos(a3) + ...
    L1^2*L2*M2*M3^2*R2^2*R3*V1^2*cos(a2 + a3)*sin(a2) + ...
    L1^2*L2^2*M2*M3^2*R2*R3*V1^2*cos(a2 + a3)*sin(a2) + ...
    L1^2*L2*M2*M3^2*R2^2*R3*V2^2*cos(a2 + a3)*sin(a2) + ...
    L1^2*L2^2*M2*M3^2*R2*R3*V2^2*cos(a2 + a3)*sin(a2) - ...
    2*L1^3*L2*M2*M3^2*R2*R3*V1^2*sin(a2 + a3)*cos(a2)^2 + ...
    2*L1^2*L2*M2*M3^2*R2*R3*grav*cos(a2)^2*sin(a1 + a2 + a3));

ddt3_c_num_general = -(L1^2*L2*M2*M3^2*R3^2*grav*cos(a2 + a3)*cos(a3)*sin(a1) + ...
    L1*M1*M2*M3*R1^2*R2^2*R3*V1^2*sin(a2 + a3) - ...
    L1^3*M2*M3^2*R2*R3^2*V1^2*cos(a2 + a3)*sin(a2 + a3)*cos(a2) - ...
    L1*L2^2*M1*M3^2*R1^2*R3*V1^2*cos(a3)*sin(a2) - 2*L1^2*L2*M2*M3^2*R2*R3^2*V1^2*cos(a2)*sin(a2) - ...
    2*L1^2*L2*M2*M3^2*R2*R3^2*V2^2*cos(a2)*sin(a2) + 4*L1^2*L2^2*M2*M3^2*R3^2*V1*V2*cos(a3)*sin(a3) +...
     2*L1^2*L2^2*M2*M3^2*R3^2*V1*V3*cos(a3)*sin(a3) + ...
    2*L1^2*L2^2*M2*M3^2*R3^2*V2*V3*cos(a3)*sin(a3) - ...
    2*L1^2*M2^2*M3*R2^2*R3^2*V1*V2*cos(a2)*sin(a2) + ...
    4*L2^2*M1*M3^2*R1^2*R3^2*V1*V2*cos(a3)*sin(a3) + 2*L2^2*M1*M3^2*R1^2*R3^2*V1*V3*cos(a3)*sin(a3) + ...
    2*L2^2*M1*M3^2*R1^2*R3^2*V2*V3*cos(a3)*sin(a3) + ...
    L1^2*M2*M3^2*R2*R3^2*grav*cos(a2 + a3)*cos(a2)*sin(a1 + a2 + a3) + ...
    L1*L2^2*M1*M3^2*R1*R3*grav*cos(a2 + a3)*sin(a1) + ...
    L1^2*L2*M2*M3^2*R2*R3*grav*sin(a1 + a2)*cos(a3) + ...
    L1^2*L2*M2^2*M3*R2*R3*grav*sin(a1 + a2)*cos(a3) - ...
    2*L1^2*L2^3*M3^3*R3*V1*V2*cos(a2)*cos(a3)*sin(a2) - ...
    L1^2*L2^2*M2*M3^2*R3*grav*cos(a2)*cos(a3)*sin(a1) - L1*M1*M2*M3*R1^2*R2*R3^2*V1^2*sin(a2) + ...
    L2*M1*M2*M3*R1^2*R2^2*R3*V1^2*sin(a3) + L2*M1*M2*M3*R1^2*R2^2*R3*V2^2*sin(a3) + ...
    2*L1^2*L2*M2*M3^2*R2^2*R3*V1*V2*sin(a3) + 2*L1^2*L2*M2^2*M3*R2^2*R3*V1*V2*sin(a3) + ...
    L1^3*M2^2*M3*R2^2*R3*V1^2*cos(a2 + a3)*cos(a2)*sin(a2) - ...
    4*L1^2*L2^2*M3^3*R3^2*V1*V2*cos(a2 + a3)*cos(a2)*sin(a3) + ...
    2*L1^2*L2^2*M3^3*R3^2*V1*V2*cos(a2 + a3)*cos(a3)*sin(a2) - ...
    2*L1^2*L2^2*M3^3*R3^2*V1*V2*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    2*L1^2*L2^2*M3^3*R3^2*V1*V3*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    2*L1^2*L2^2*M3^3*R3^2*V1*V3*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    2*L1^2*L2^2*M3^3*R3^2*V2*V3*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    2*L1^2*L2^2*M3^3*R3^2*V2*V3*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    L1*L2*M1*M3^2*R1*R3^2*grav*cos(a2)*sin(a1) - 2*L1^2*L2*M2*M3^2*R2*R3^2*V1^2*cos(a2 + a3)*cos(a2)*sin(a3) + ...
    L1^2*L2*M2*M3^2*R2*R3^2*V1^2*cos(a2 + a3)*cos(a3)*sin(a2) - ...
    L1^2*L2*M2*M3^2*R2*R3^2*V1^2*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    2*L1^2*L2*M2*M3^2*R2*R3^2*V2^2*cos(a2 + a3)*cos(a2)*sin(a3) + ...
    L1^2*L2*M2*M3^2*R2*R3^2*V2^2*cos(a2 + a3)*cos(a3)*sin(a2) - ...
    L1^2*L2*M2*M3^2*R2*R3^2*V2^2*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    L1^2*L2*M2*M3^2*R2*R3^2*V3^2*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    L1^2*L2*M2*M3^2*R2*R3^2*V3^2*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    2*L1^2*L2*M2*M3^2*R2*R3*grav*cos(a2 + a3)*sin(a1 + a2)*cos(a2) + ...
    2*L1^2*L2*M2*M3^2*R2^2*R3*V1*V2*cos(a2 + a3)*sin(a2) + ...
    2*L1^2*L2^2*M2*M3^2*R2*R3*V1*V2*cos(a2 + a3)*sin(a2) - ...
    L1^2*L2*M2^2*M3*R2^2*R3*V1^2*cos(a2)*cos(a3)*sin(a2) - ...
    2*L1^2*L2^2*M2*M3^2*R2*R3*V1^2*cos(a2)*cos(a3)*sin(a2) - ...
    L1^2*L2*M2^2*M3*R2^2*R3*V2^2*cos(a2)*cos(a3)*sin(a2) - ...
    2*L1^2*L2^2*M2*M3^2*R2*R3*V2^2*cos(a2)*cos(a3)*sin(a2) + ...
    L1*L2*M1*M3^2*R1*R3^2*grav*cos(a2 + a3)*cos(a3)*sin(a1) - ...
    4*L1^2*L2*M2*M3^2*R2*R3^2*V1*V2*cos(a2)*sin(a2) + ...
    L1*M1*M2*M3*R1*R2^2*R3*grav*cos(a2 + a3)*sin(a1) + ...
    L2*M1*M2*M3*R1^2*R2*R3*grav*sin(a1 + a2)*cos(a3) - ...
    L1*L2^2*M1*M3^2*R1*R3*grav*cos(a2)*cos(a3)*sin(a1) - ...
    L1^2*L2*M2*M3^2*R2*R3*grav*cos(a2)*cos(a3)*sin(a1) - ...
    L1^2*L2*M2^2*M3*R2*R3*grav*cos(a2)*cos(a3)*sin(a1) + ...
    2*L2*M1*M2*M3*R1^2*R2^2*R3*V1*V2*sin(a3) + ...
    2*L1^3*L2*M2*M3^2*R2*R3*V1^2*cos(a2 + a3)*cos(a2)*sin(a2) - ...
    L1*M1*M2*M3*R1*R2*R3^2*grav*cos(a2)*sin(a1) - 2*L1^2*L2*M2^2*M3*R2^2*R3*V1*V2*cos(a2)^2*sin(a3) - ...
    4*L1^2*L2^2*M2*M3^2*R2*R3*V1*V2*cos(a2)^2*sin(a3) - ...
    4*L1^2*L2*M2*M3^2*R2*R3^2*V1*V2*cos(a2 + a3)*cos(a2)*sin(a3) + ...
    2*L1^2*L2*M2*M3^2*R2*R3^2*V1*V2*cos(a2 + a3)*cos(a3)*sin(a2) - ...
    2*L1^2*L2*M2*M3^2*R2*R3^2*V1*V2*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    2*L1^2*L2*M2*M3^2*R2*R3^2*V1*V3*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    2*L1^2*L2*M2*M3^2*R2*R3^2*V1*V3*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    2*L1^2*L2*M2*M3^2*R2*R3^2*V2*V3*cos(a2 + a3)*cos(a2)*sin(a3) - ...
    2*L1^2*L2*M2*M3^2*R2*R3^2*V2*V3*sin(a2 + a3)*cos(a2)*cos(a3) - ...
    2*L1^2*L2*M2^2*M3*R2^2*R3*V1*V2*cos(a2)*cos(a3)*sin(a2) - ...
    4*L1^2*L2^2*M2*M3^2*R2*R3*V1*V2*cos(a2)*cos(a3)*sin(a2) - ...
    L1*L2*M1*M2*M3*R1^2*R2*R3*V1^2*cos(a3)*sin(a2) - ...
    L1*L2*M1*M2*M3*R1*R2*R3*grav*cos(a2)*cos(a3)*sin(a1));

ddt3_denom = M3*R3*(L1^2*L2^2*M3^2*R3 + L1^2*M2^2*R2^2*R3 - ...
    L1^2*L2^2*M3^2*R3*cos(a2 + a3)^2 + L1^2*L2^2*M2*M3*R3 + ...
    L2^2*M1*M3*R1^2*R3 + L1^2*M2*M3*R2^2*R3 + M1*M2*R1^2*R2^2*R3 - ...
    L1^2*L2^2*M3^2*R3*cos(a2)^2 - L1^2*L2^2*M3^2*R3*cos(a3)^2 - ...
    L1^2*M2^2*R2^2*R3*cos(a2)^2 - L1^2*M2*M3*R2^2*R3*cos(a2 + a3)^2 - ...
    L1^2*L2^2*M2*M3*R3*cos(a3)^2 - L2^2*M1*M3*R1^2*R3*cos(a3)^2 - ...
    2*L1^2*L2*M2*M3*R2*R3*cos(a2)^2 + ...
    2*L1^2*L2^2*M3^2*R3*cos(a2 + a3)*cos(a2)*cos(a3) + ...
    2*L1^2*L2*M2*M3*R2*R3*cos(a2 + a3)*cos(a2)*cos(a3));


switch dim
  case 1
    alpha = abs(v1);
    
  case 2
    alpha = T1Max*abs(ddt1_num_tau1/ddt1_denom)+...
T2Max*abs(ddt1_num_tau2/ddt1_denom)+...
T3Max*abs(ddt1_num_tau3/ddt1_denom)+...
abs(ddt1_num_general/ddt1_denom);
    
  case 3
    alpha = abs(v2);
  
  case 4
    alpha = T1Max*abs(-ddt2_num_tau1/ddt2_denom)+...
T2Max*abs(-ddt2_num_tau2/ddt2_denom)+...
T3Max*abs(-ddt2_num_tau3/ddt2_denom)+...
abs(-ddt2_a_num_general/ddt2_denom)+...
abs(ddt2_b_num_general/ddt2_denom);

  case 5
    alpha = abs(v3);
    
  case 6
    alpha = T1Max*abs(-ddt3_num_tau1/ddt3_denom) + ...  
T2Max*abs(-ddt3_num_tau2/ddt3_denom) + ...
T3Max*abs(-ddt3_num_tau3/ddt3_denom) + ...
abs(-ddt3_a_num_general/ddt3_denom)+...
abs(ddt3_b_num_general/ddt3_denom) +...
abs(ddt3_c_num_general/ddt3_denom) ;
    
end


end